<app-create-channel *ngIf="isCreateChannelOpen" (close)="closeCreateChannel()"></app-create-channel>
<aside class="workspace">
  <header class="workspace__header">
    <div class="workspace__brand">
      <img src="imgs/workspace/Workspace logo.png" alt="Workspace Logo" />
      <div class="workspace__titles">
        <h1>Devspace</h1>
      </div>
    </div>
    <div class="workspace__actions">
      <button
        class="workspace__icon-btn workspace__icon-btn--solid"
        type="button"
        aria-label="Neue Nachricht"
        (click)="startNewMessage()">
        <img src="imgs/workspace/new message.svg" alt="Neue Nachricht" />
      </button>
    </div>
  </header>

  <nav class="workspace__nav">
    <div class="workspace__section">
      <div class="workspace__section-header">
        <button
          class="workspace__section-toggle"
          [class.workspace__section-toggle--hovered]="isChannelsHeaderHovered"
          type="button"
          (click)="toggleChannels()"
          (mouseenter)="isChannelsHeaderHovered = true"
          (mouseleave)="isChannelsHeaderHovered = false"
          [attr.aria-expanded]="!areChannelsCollapsed"
          aria-controls="workspace-channels">
          <span class="workspace__chevron" [class.workspace__chevron--active]="isChannelsHeaderHovered">{{
            areChannelsCollapsed ? '▸' : '▾'
          }}</span>
          <img
            [src]="
              isChannelsHeaderHovered
                ? 'imgs/workspace/channellist img hover.svg'
                : 'imgs/workspace/channellist img.png'
            "
            alt="Kanäle" />
          <span class="workspace__section-label" [class.workspace__section-label--active]="isChannelsHeaderHovered">
            Channels
          </span>
        </button>
        <button
          class="workspace__icon-btn workspace__icon-btn--ghost"
          type="button"
          aria-label="Neuen Channel hinzufügen"
          (click)="openCreateChannel()"
          (mouseenter)="isAddChannelHovered = true"
          (mouseleave)="isAddChannelHovered = false">
          <img
            [src]="isAddChannelHovered ? 'imgs/workspace/add channel-hover.svg' : 'imgs/workspace/add channel.svg'"
            alt="Neuen Channel hinzufügen" />
        </button>
      </div>
      <ng-container *ngIf="!areChannelsCollapsed">
        <ul class="workspace__list" id="workspace-channels">
          <li *ngFor="let channel of channelsWithUnread$ | async">
            <button
              class="workspace__list-item"
              type="button"
              [class.workspace__list-item--active]="(activeChannelId$ | async) === channel.id"
              [class.workspace__list-item--unread]="channel.unreadCount > 0"
              (click)="selectChannel(channel.id)">
              <span class="workspace__hash">#</span>
              <span class="workspace__channel-name">{{ channel.title || 'Unbenannter Channel' }}</span>
              <span *ngIf="channel.unreadCount > 0" class="workspace__unread-badge">
                {{ channel.unreadCount }}
              </span>
            </button>
          </li>
        </ul>
        <button class="workspace__add-btn" type="button" (click)="openCreateChannel()">
          <img src="imgs/workspace/add new channel.png" alt="Neuen Channel anlegen" />
          <span>Channel hinzufügen</span>
        </button>
      </ng-container>
    </div>
    <div class="workspace__section">
      <div class="workspace__section-header">
        <button
          class="workspace__section-toggle"
          [class.workspace__section-toggle--hovered]="isDirectMessagesHeaderHovered"
          type="button"
          (click)="toggleDirectMessages()"
          (mouseenter)="isDirectMessagesHeaderHovered = true"
          (mouseleave)="isDirectMessagesHeaderHovered = false"
          [attr.aria-expanded]="!areDirectMessagesCollapsed"
          aria-controls="workspace-direct-messages">
          <span class="workspace__chevron" [class.workspace__chevron--active]="isDirectMessagesHeaderHovered">{{
            areDirectMessagesCollapsed ? '▸' : '▾'
          }}</span>
          <img
            [src]="
              isDirectMessagesHeaderHovered
                ? 'imgs/workspace/direct messages img-hover.svg'
                : 'imgs/workspace/direct messages img.svg'
            "
            alt="Direktnachrichten" />
          <span
            class="workspace__section-label"
            [class.workspace__section-label--active]="isDirectMessagesHeaderHovered">
            Direktnachrichten
          </span>
          <ng-container *ngIf="directMessageUnreadTotal$ | async as unreadTotal">
            <span class="workspace__section-badge workspace__section-badge--active" *ngIf="unreadTotal > 0">
              {{ unreadTotal }}
            </span>
          </ng-container>
        </button>
      </div>
      <ul
        *ngIf="!areDirectMessagesCollapsed"
        class="workspace__list workspace__list--direct"
        id="workspace-direct-messages">
        <ng-container *ngIf="directMessageUsers$ | async as users">
          <li *ngFor="let user of users">
            <button
              type="button"
              class="workspace__list-item workspace__list-item--direct"
              [class.workspace__list-item--active]="(activeDmId$ | async) === user.uid"
              [class.workspace__list-item--unread]="user.unreadCount > 0"
              (click)="openDirectMessage(user)">
              <div class="relative">
                <img
                  class="workspace__avatar"
                  [src]="user.photoUrl || 'imgs/default-profile-picture.png'"
                  [alt]="user.name" />
                <span
                  class="absolute right-0 bottom-0 size-3 rounded-full border-2 border-white"
                  [ngClass]="user.onlineStatus ? 'bg-green-500' : 'bg-gray-400'">
                </span>
              </div>
              <div class="workspace__user-details">
                <span class="workspace__user-name">{{ user.displayName }}</span>
              </div>
              <span *ngIf="user.unreadCount > 0" class="workspace__unread-badge">{{ user.unreadCount }}</span>
            </button>
          </li>
        </ng-container>
      </ul>
    </div>
  </nav>
</aside>
