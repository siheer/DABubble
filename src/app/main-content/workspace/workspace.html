<app-create-channel *ngIf="isCreateChannelOpen" (close)="closeCreateChannel()"></app-create-channel>
<aside class="workspace lg:mr-4">
  <header class="workspace__header">
    <div class="workspace__brand">
      <img src="imgs/workspace/Workspace logo.png" alt="Workspace Logo" />
      <div class="workspace__titles">
        <h1>Devspace</h1>
      </div>
    </div>
    <div class="workspace__actions">
      <button
        class="workspace__icon-btn workspace__icon-btn--solid"
        type="button"
        aria-label="Neue Nachricht"
        (click)="startNewMessage()">
        <img src="imgs/workspace/new message.svg" alt="Neue Nachricht" />
      </button>
    </div>
    <div clickOutside (clickOutside)="closeDropdown()" class="workspace__search relative">
      <input
        matInput
        [(ngModel)]="searchTerm"
        (focus)="onFocus()"
        (blur)="onBlur()"
        (input)="onSearchInput($event)"
        type="text"
        placeholder="Gehe zu..."
        aria-label="Workspace durchsuchen" />
      <span class="workspace__search-icon material-icons" aria-hidden="true">search</span>
      <app-filter-box
        *ngIf="dropdownOpen"
        [isFocused]="true"
        [searchTerm]="searchTerm"
        (close)="closeDropdown()"></app-filter-box>
    </div>
  </header>

  <nav class="workspace__nav">
    <div class="workspace__section">
      <div class="workspace__section-header">
        <button
          class="workspace__section-toggle"
          [class.workspace__section-toggle--hovered]="isChannelsHeaderHovered"
          type="button"
          (click)="toggleChannels()"
          (mouseenter)="isChannelsHeaderHovered = true"
          (mouseleave)="isChannelsHeaderHovered = false"
          [attr.aria-expanded]="!areChannelsCollapsed"
          aria-controls="workspace-channels">
          <span class="workspace__chevron" [class.workspace__chevron--active]="isChannelsHeaderHovered">{{
            areChannelsCollapsed ? '▸' : '▾'
          }}</span>
          <img
            [src]="
              isChannelsHeaderHovered
                ? 'imgs/workspace/channellist img hover.svg'
                : 'imgs/workspace/channellist img.png'
            "
            alt="Kanäle" />
          <span class="workspace__section-label" [class.workspace__section-label--active]="isChannelsHeaderHovered">
            Channels
          </span>
        </button>
        <button
          class="workspace__icon-btn workspace__icon-btn--ghost"
          type="button"
          aria-label="Neuen Channel hinzufügen"
          (click)="openCreateChannel()"
          (mouseenter)="isAddChannelHovered = true"
          (mouseleave)="isAddChannelHovered = false">
          <img
            [src]="isAddChannelHovered ? 'imgs/workspace/add channel-hover.svg' : 'imgs/workspace/add channel.svg'"
            alt="Neuen Channel hinzufügen" />
        </button>
      </div>
      <ng-container *ngIf="!areChannelsCollapsed">
        <ul class="workspace__list" id="workspace-channels">
          <li *ngFor="let channel of channelsWithUnread$ | async; trackBy: trackChannel">
            <button
              class="workspace__list-item"
              type="button"
              [class.workspace__list-item--active]="activeChannelId() === channel.id"
              [class.workspace__list-item--unread]="channel.unreadCount > 0"
              (click)="selectChannel(channel.id)">
              <span class="workspace__hash">#</span>
              <span class="workspace__channel-name">{{ channel.title || 'Unbenannter Channel' }}</span>
              <span *ngIf="channel.unreadCount > 0" class="workspace__unread-badge">
                {{ channel.unreadCount }}
              </span>
            </button>
          </li>
        </ul>
        <button class="workspace__add-btn" type="button" (click)="openCreateChannel()">
          <img src="imgs/workspace/add new channel.png" alt="Neuen Channel anlegen" />
          <span>Channel hinzufügen</span>
        </button>
      </ng-container>
    </div>
    <div class="workspace__section">
      <div class="workspace__section-header">
        <button
          class="workspace__section-toggle"
          [class.workspace__section-toggle--hovered]="isDirectMessagesHeaderHovered"
          type="button"
          (click)="toggleDirectMessages()"
          (mouseenter)="isDirectMessagesHeaderHovered = true"
          (mouseleave)="isDirectMessagesHeaderHovered = false"
          [attr.aria-expanded]="!areDirectMessagesCollapsed"
          aria-controls="workspace-direct-messages">
          <span class="workspace__chevron" [class.workspace__chevron--active]="isDirectMessagesHeaderHovered">{{
            areDirectMessagesCollapsed ? '▸' : '▾'
          }}</span>
          <img
            [src]="
              isDirectMessagesHeaderHovered
                ? 'imgs/workspace/direct messages img-hover.svg'
                : 'imgs/workspace/direct messages img.svg'
            "
            alt="Direktnachrichten" />
          <span
            class="workspace__section-label"
            [class.workspace__section-label--active]="isDirectMessagesHeaderHovered">
            Direktnachrichten
          </span>
          <ng-container *ngIf="directMessageUnreadTotal$ | async as unreadTotal">
            <span class="workspace__section-badge workspace__section-badge--active" *ngIf="unreadTotal > 0">
              {{ unreadTotal }}
            </span>
          </ng-container>
        </button>
      </div>
      <ul
        *ngIf="!areDirectMessagesCollapsed"
        class="workspace__list workspace__list--direct"
        id="workspace-direct-messages">
        <ng-container *ngIf="directMessageUsers$ | async as users">
          <li *ngFor="let user of users; trackBy: trackDirectUser">
            <button
              type="button"
              class="workspace__list-item workspace__list-item--direct"
              [class.workspace__list-item--active]="activeDmId() === user.uid"
              [class.workspace__list-item--unread]="user.unreadCount > 0"
              (click)="openDirectMessage(user)">
              <div class="relative">
                <img
                  class="workspace__avatar"
                  [src]="user.photoUrl || 'imgs/default-profile-picture.png'"
                  [alt]="user.name" />
                <span
                  class="absolute right-0 bottom-0 size-3 rounded-full border-2 border-white"
                  [ngClass]="user.onlineStatus ? 'bg-green-500' : 'bg-gray-400'">
                </span>
              </div>
              <div class="workspace__user-details">
                <span class="workspace__user-name">{{ user.displayName }}</span>
              </div>
              <span *ngIf="user.unreadCount > 0" class="workspace__unread-badge">{{ user.unreadCount }}</span>
            </button>
          </li>
        </ng-container>
      </ul>
    </div>
  </nav>
</aside>

<button
  class="mobile-workspace-button lg:hidden!"
  type="button"
  aria-label="Neue Nachricht"
  (click)="startNewMessage()">
  <div
    class="-mt-0.5 grid size-12 place-items-center rounded-full bg-dab-purple-1 hover:bg-dab-purple-3 focus-visible:bg-dab-purple-3">
    <svg
      width="21"
      height="21"
      viewBox="0 0 21 21"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
      class="-mt-0.5 -mr-0.5 scale-85">
      <path
        d="M2 20.525C1.45 20.525 0.979167 20.3292 0.5875 19.9375C0.195833 19.5458 0 19.075 0 18.525V4.525C0 3.975 0.195833 3.50417 0.5875 3.1125C0.979167 2.72083 1.45 2.525 2 2.525H10.925L8.925 4.525H2V18.525H16V11.575L18 9.575V18.525C18 19.075 17.8042 19.5458 17.4125 19.9375C17.0208 20.3292 16.55 20.525 16 20.525H2ZM13.175 3.1L14.6 4.5L8 11.1V12.525H9.4L16.025 5.9L17.45 7.3L10.825 13.925C10.6417 14.1083 10.4292 14.2542 10.1875 14.3625C9.94583 14.4708 9.69167 14.525 9.425 14.525H7C6.71667 14.525 6.47917 14.4292 6.2875 14.2375C6.09583 14.0458 6 13.8083 6 13.525V11.1C6 10.8333 6.05 10.5792 6.15 10.3375C6.25 10.0958 6.39167 9.88333 6.575 9.7L13.175 3.1ZM17.45 7.3L13.175 3.1L15.675 0.6C16.075 0.2 16.5542 0 17.1125 0C17.6708 0 18.1417 0.2 18.525 0.6L19.925 2.025C20.3083 2.40833 20.5 2.875 20.5 3.425C20.5 3.975 20.3083 4.44167 19.925 4.825L17.45 7.3Z"
        fill="white" />
    </svg>
  </div>
</button>
