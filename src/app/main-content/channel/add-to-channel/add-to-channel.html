<section
  *ngIf="visible"
  class="add-to-channel"
  [class.mobile]="mode === 'mobile'"
  [@fadeScale]="visible ? 'enter' : 'leave'"
  (@fadeScale.done)="onAnimationDone()"
  role="dialog"
  aria-modal="true"
  [attr.aria-label]="'Mitglieder zu ' + channelTitle + ' hinzufügen'">
  <header class="add-to-channel__header">
    <span class="add-to-channel__title">Leute hinzufügen</span>
    <button type="button" class="add-to-channel__close" aria-label="Overlay schließen" (click)="closeOverlay()">
      <span class="material-icons">close</span>
    </button>
  </header>

  <div class="add-to-channel__channel-tag" aria-label="Aktueller Channel">
    <span># {{ channelTitle }}</span>
  </div>

  <form class="add-to-channel__search" (ngSubmit)="onSubmit()">
    <div class="add-to-channel__field">
    
      <input
        id="add-to-channel-search"
        type="text"
        placeholder="Name eingeben"
        aria-label="Mitglied suchen"
        name="memberSearch"
        [(ngModel)]="searchTerm"
        (ngModelChange)="onSearch($event)"
        (focus)="onSearchFocus()" />
    </div>

    <div *ngIf="selectedMembers.length" class="add-to-channel__chips" aria-live="polite">
      <div *ngFor="let member of selectedMembers" class="add-to-channel__chip">
        <img [src]="member.avatar" [alt]="member.name" />
        <span class="truncate">{{ member.name }}</span>
        <button type="button" aria-label="{{ member.name }} entfernen" (click)="removeSelectedMember(member.id)">
          <span class="material-icons">close</span>
        </button>
      </div>
    </div>

    <div class="add-to-channel__dropdown" *ngIf="showSuggestions">
      <div *ngIf="filteredMembers.length === 0" class="add-to-channel__empty">
        Alle Mitglieder sind bereits im Channel.
      </div>

      <button
        type="button"
        *ngFor="let member of filteredMembers"
        class="add-to-channel__option"
        (click)="selectMember(member)"
        aria-label="{{ member.name }} zum Channel hinzufügen">
        <img [src]="member.avatar" [alt]="member.name" />
        <div class="add-to-channel__option-meta">
          <span class="add-to-channel__option-name truncate">{{ member.name }}</span>
          <span *ngIf="member.subtitle" class="add-to-channel__option-subtitle truncate">{{ member.subtitle }}</span>
        </div>
        <span *ngIf="member.status === 'online'" class="add-to-channel__status" aria-label="Online"></span>
      </button>

      <div class="add-to-channel__dropdown-actions">
        <button type="button" class="add-to-channel__dropdown-confirm" (click)="confirmSuggestions()">
          Auswahl bestätigen
        </button>
      </div>
    </div>

    <p *ngIf="saveError" class="add-to-channel__error" role="alert">{{ saveError }}</p>

    <footer class="add-to-channel__actions">
      <button type="button" class="add-to-channel__cancel" (click)="closeOverlay()">Abbrechen</button>
      <button type="submit" class="add-to-channel__confirm" [disabled]="!selectedMembers.length || isSaving">
        <ng-container *ngIf="!isSaving; else saving"> Hinzufügen </ng-container>
        <ng-template #saving>Wird hinzugefügt...</ng-template>
      </button>
    </footer>
  </form>
</section>
