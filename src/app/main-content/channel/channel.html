<section class="channel">
  <header class="channel__header">
    <div class="channel__titles">
      <div class="channel__title-row">
        <h1># {{ (channelTitle$ | async) ?? channelDefaults.name }}</h1>
        <button
          type="button"
          class="channel__description-trigger"
          aria-label="Channel-Beschreibung öffnen"
          (click)="openChannelDescription($event)">
          <img src="imgs/channel description/keyboard_arrow_down.svg" alt="Channel-Beschreibung öffnen" />
        </button>
      </div>
    </div>
    <div class="channel__actions">
      <ng-container *ngIf="members$ | async as members">
        <button
          type="button"
          class="channel__member-preview"
          aria-label="Mitgliederübersicht"
          (click)="openChannelMembers($event)">
          <div class="channel__avatars" aria-hidden="true">
            <ng-container *ngFor="let member of members | slice: 0 : 3; let i = index">
              <img [src]="member.avatar" [alt]="member.name" [style.zIndex]="members.length - i" />
            </ng-container>
          </div>
          <span class="channel__member-count">{{ members.length }}</span>
        </button>
      </ng-container>

      <button
        type="button"
        class="channel__add-member"
        aria-label="Mitglied zum Channel hinzufügen"
        (click)="openAddToChannel($event)">
        <img src="imgs/channels/person_add.svg" alt="Mitglied hinzufügen" />
      </button>
    </div>
  </header>

  <section class="channel__panel">
    <div class="channel__messages" aria-live="polite">
      <ng-container *ngIf="messagesByDay$ | async as messagesByDay">
        <ng-container *ngIf="messagesByDay.length; else noMessages">
          <ng-container *ngFor="let day of messagesByDay">
            <div class="channel__day">
              <span>{{ day.label }}</span>
            </div>

            <article *ngFor="let message of day.messages" class="channel__message">
              <img class="channel__message-avatar" [src]="message.avatar" [alt]="message.author" />

              <div class="channel__message-body">
                <header class="channel__message-header">
                  <div class="channel__message-meta">
                    <div class="channel__author-line">
                      <strong>{{ message.author }}</strong>
                      <time>{{ message.time }}</time>
                    </div>
                    <div class="channel__tags">
                      <span *ngIf="message.tag" class="channel__pill">{{ message.tag }}</span>
                      <button type="button" class="channel__icon-button" aria-label="Nachricht favorisieren">
                        <mat-icon>favorite_border</mat-icon>
                      </button>
                      <button type="button" class="channel__icon-button" aria-label="Weitere Aktionen">
                        <mat-icon>more_horiz</mat-icon>
                      </button>
                    </div>
                  </div>
                </header>
                <p class="channel__message-text">{{ message.text }}</p>

                <ng-container *ngIf="message.attachment as attachment">
                  <div class="channel__attachment">
                    <div class="channel__attachment-text">
                      <span *ngIf="attachment.badgeLabel" class="channel__pill channel__pill--info">
                        {{ attachment.badgeLabel }}
                      </span>
                      <h3>{{ attachment.title }}</h3>
                      <p *ngIf="attachment.description">{{ attachment.description }}</p>
                    </div>
                    <a *ngIf="attachment.linkLabel" class="channel__attachment-link" [href]="attachment.linkHref">
                      {{ attachment.linkLabel }}
                      <mat-icon>open_in_new</mat-icon>
                    </a>
                  </div>
                </ng-container>

                <footer class="channel__message-footer">
                  <button type="button" class="channel__reaction" aria-label="Smiley hinzufügen">
                    <mat-icon>sentiment_satisfied</mat-icon>
                  </button>
                  <button type="button" class="channel__reaction" aria-label="Antwort schreiben">
                    <mat-icon>reply</mat-icon>
                  </button>
                  <button type="button" class="channel__reaction" aria-label="Link teilen">
                    <mat-icon>link</mat-icon>
                  </button>
                  <span class="channel__reply-count" *ngIf="message.replies"> {{ message.replies }} Antworten </span>
                </footer>
              </div>
            </article>
          </ng-container>
        </ng-container>
      </ng-container>
      <ng-template #noMessages>
        <p class="channel__empty">Noch keine Nachrichten vorhanden.</p>
      </ng-template>
    </div>

    <form class="channel__composer" aria-label="Neue Nachricht verfassen" (ngSubmit)="sendMessage()">
      <textarea
        rows="3"
        name="message"
        [(ngModel)]="messageText"
        [placeholder]="'Nachricht an #' + ((channelTitle$ | async) ?? channelDefaults.name)"></textarea>
      <div class="channel__composer-actions">
        <button type="submit" aria-label="Nachricht senden" [disabled]="!messageText.trim() || isSending">
          <img src="imgs/channels/send.svg" alt="" />
        </button>
      </div>
    </form>
  </section>
</section>
