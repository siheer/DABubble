<app-aside-content-wrapper>
  <div topRight class="flex flex-col items-end gap-2">
    <p>Zur Anmeldung?</p>
    <a routerLink="/login" class="dab-anchor-on-bg -mr-4">Anmelden</a>
  </div>

  <div card>
    <button type="button" aria-label="Zurück zur Anmeldung" class="dab-ui-item back-btn" (click)="onBackToLogin()">
      <span class="material-icons">arrow_back</span>
    </button>

    <h1>Passwort zurücksetzen</h1>

    @if (isLoading) {
      <p class="paragraph-20">Wir prüfen deinen Link zum Zurücksetzen des Passworts.</p>
    } @else {
      @if (errorMessage) {
        <p class="dab-inline-error">
          {{ errorMessage }}
        </p>

        <div class="mt-6 flex justify-center">
          <a routerLink="/login" class="dab-btn-primary">Zur Anmeldung</a>
        </div>
      } @else {
        <p class="paragraph-20 mb-6">Gib dein neues Passwort ein und bestätige es.</p>

        <form #resetPasswordForm="ngForm" (ngSubmit)="onSubmit(resetPasswordForm)" novalidate class="dab-form">
          <div>
            <div class="dab-input-field">
              <label for="newPassword" class="sr-only">Neues Passwort</label>
              <span class="material-icons-outlined icon">lock</span>
              <input
                id="newPassword"
                name="newPassword"
                type="password"
                autocomplete="new-password"
                required
                placeholder="Neues Passwort"
                [(ngModel)]="newPassword"
                #newPasswordModel="ngModel" />
            </div>
            @if (newPasswordModel.invalid && newPasswordModel.touched) {
              <p class="dab-field-error">Bitte gib ein neues Passwort ein.</p>
            }
          </div>

          <div>
            <div class="dab-input-field">
              <label for="confirmPassword" class="sr-only">Neues Kennwort bestätigen</label>
              <span class="material-icons-outlined icon">lock</span>
              <input
                id="confirmPassword"
                name="confirmPassword"
                type="password"
                autocomplete="new-password"
                required
                placeholder="Neues Kennwort bestätigen"
                [(ngModel)]="confirmPassword"
                #confirmPasswordModel="ngModel" />
            </div>
            @if (confirmPasswordModel.invalid && confirmPasswordModel.touched) {
              <p class="dab-field-error">Bitte bestätige dein neues Passwort.</p>
            }
          </div>

          @if (passwordValidationErrors.length > 0) {
            <ul class="mt-2 space-y-1 px-2 text-xs text-dab-rosa-error">
              @for (message of passwordValidationErrors; track $index) {
                <li class="flex gap-2">
                  <span>•</span>
                  <span>{{ message }}</span>
                </li>
              }
            </ul>
          }

          @if (infoMessage) {
            <p class="dab-inline-info">
              {{ infoMessage }}
            </p>
          }

          @if (formErrorMessage) {
            <p class="dab-inline-error">
              {{ formErrorMessage }}
            </p>
          }

          <div class="flex justify-end">
            <button
              type="submit"
              [disabled]="isSubmitting || resetPasswordForm.invalid || infoMessage"
              class="dab-btn-primary">
              {{ isSubmitting ? 'Passwort wird geändert …' : 'Passwort ändern' }}
            </button>
          </div>
        </form>
      }
    }
  </div>
</app-aside-content-wrapper>
