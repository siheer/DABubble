<app-aside-content-wrapper>
  <div topRight class="flex flex-col items-end gap-2">
    <p>Schon registriert?</p>
    <a routerLink="/login" class="dab-anchor-on-bg -mr-4">Anmelden</a>
  </div>

  <div card>
    @if (!isAvatarStep) {
      <button type="button" aria-label="Zurück zur Anmeldung" class="dab-ui-item back-btn" (click)="onBackToLogin()">
        <span class="material-icons">arrow_back</span>
      </button>

      <div class="mb-6">
        <h1>Konto erstellen</h1>
        <p class="paragraph-20">
          Registriere dich mit Namen und E-Mail-Adresse oder nutze den <a routerLink="/login">Google Login</a>.
        </p>
      </div>

      <form #signupForm="ngForm" (ngSubmit)="onFirstSignupStep(signupForm)" novalidate class="dab-form">
        <div>
          <div class="dab-input-field">
            <label for="fullName" class="sr-only">Name und Nachname</label>
            <span class="material-icons-outlined icon">person</span>
            <input
              id="fullName"
              name="fullName"
              type="text"
              autocomplete="name"
              required
              pattern="^(?=(?:.*\S){3,}).*$"
              placeholder="Name und Nachname"
              [(ngModel)]="name"
              (blur)="onNameBlur()"
              #nameModel="ngModel" />
          </div>
          @if (nameModel.invalid && nameModel.touched) {
            @if (nameModel.errors?.['required']) {
              <p class="dab-field-error">Bitte gib deinen Namen ein.</p>
            }
            @if (nameModel.errors?.['pattern']) {
              <p class="dab-field-error">Bitte gib mindestens 3 Zeichen ein.</p>
            }
          }
        </div>

        <div>
          <div class="dab-input-field">
            <label for="email" class="sr-only">E-Mail</label>
            <span class="material-icons-outlined icon">mail</span>
            <input
              id="email"
              name="email"
              type="email"
              pattern="^[A-Za-z0-9._%+\-]+@[A-Za-z0-9.\-]+\.[A-Za-z]{2,}$"
              autocomplete="email"
              required
              placeholder="beispielname@email.com"
              [(ngModel)]="emailAddress"
              #emailModel="ngModel" />
          </div>
          @if (emailModel.invalid && emailModel.touched) {
            <p class="dab-field-error">Bitte gib deine E-Mail-Adresse ein.</p>
          }
        </div>

        <div>
          <div class="dab-input-field">
            <label for="password" class="sr-only">Passwort</label>
            <span class="material-icons-outlined icon">lock</span>
            <input
              id="password"
              name="password"
              type="password"
              autocomplete="new-password"
              required
              placeholder="Passwort"
              [(ngModel)]="password"
              #passwordModel="ngModel" />
          </div>
          @if (passwordModel.invalid && passwordModel.touched) {
            <p class="dab-field-error">Bitte gib dein Passwort ein.</p>
          }
        </div>

        @if (passwordValidationErrors.length > 0) {
          <div class="dab-inline-error text-left">
            <ul class="list-inside list-disc">
              @for (message of passwordValidationErrors; track $index) {
                <li>
                  <span class="-ml-2">{{ message }}</span>
                </li>
              }
            </ul>
          </div>
        }

        <div>
          <mat-checkbox
            required
            name="privacy"
            [(ngModel)]="privacyAccepted"
            #privacyModel="ngModel"
            class="custom-checkbox">
            Ich stimme der
            <button type="button" class="dab-anchor-on-white-inline" (click)="openPrivacyOverlay()">Datenschutzerklärung</button>
            zu.
          </mat-checkbox>
          @if (privacyModel.invalid && privacyModel.touched) {
            <p class="dab-field-error">Bitte akzeptiere die Datenschutzerklärung.</p>
          }
        </div>

        @if (errorMessage) {
          <p class="dab-inline-error">
            {{ errorMessage }}
          </p>
        }

        <div class="flex justify-end">
          <button type="submit" [disabled]="isSubmitting || signupForm.invalid" class="dab-btn-primary">Weiter</button>
        </div>
      </form>
    } @else {
      <app-set-profile-picture
        [displayName]="name"
        [selectedProfilePictureKey]="selectedProfilePictureKey"
        [actionLabel]="isSubmitting ? 'Konto wird erstellt …' : 'Konto jetzt erstellen'"
        [isActionDisabled]="isSubmitting"
        (profilePictureChange)="onProfilePictureChange($event)"
        (back)="onBackFromAvatarStep()"
        (action)="onCompleteSignup()">
      </app-set-profile-picture>

      @if (errorMessage) {
        <p class="dab-inline-error">{{ errorMessage }}</p>
      }
    }
  </div>
</app-aside-content-wrapper>
